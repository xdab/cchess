#include "eval.h"

#define VALUE_PAWN 100
#define VALUE_KNIGHT 300
#define VALUE_BISHOP 300
#define VALUE_ROOK 500
#define VALUE_QUEEN 900
#define VALUE_KING 20000

const centipawns_t WHITE_PAWN_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {0, 0, 0, 0, 0, 0, 0, 0},
    {50, 50, 50, 50, 50, 50, 50, 50},
    {10, 10, 20, 30, 30, 20, 10, 10},
    {5, 5, 10, 25, 25, 10, 5, 5},
    {0, 0, 0, 20, 20, 0, 0, 0},
    {5, -5, -10, 0, 0, -10, -5, 5},
    {5, 10, 10, -20, -20, 10, 10, 5},
    {0, 0, 0, 0, 0, 0, 0, 0}};

const centipawns_t BLACK_PAWN_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {0, 0, 0, 0, 0, 0, 0, 0},
    {5, 10, 10, -20, -20, 10, 10, 5},
    {5, -5, -10, 0, 0, -10, -5, 5},
    {0, 0, 0, 20, 20, 0, 0, 0},
    {5, 5, 10, 25, 25, 10, 5, 5},
    {10, 10, 20, 30, 30, 20, 10, 10},
    {50, 50, 50, 50, 50, 50, 50, 50},
    {0, 0, 0, 0, 0, 0, 0, 0}};

const centipawns_t KNIGHT_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {-50, -40, -30, -30, -30, -30, -40, -50},
    {-40, -20, 0, 0, 0, 0, -20, -40},
    {-30, 0, 10, 15, 15, 10, 0, -30},
    {-30, 5, 15, 20, 20, 15, 5, -30},
    {-30, 0, 15, 20, 20, 15, 0, -30},
    {-30, 5, 10, 15, 15, 10, 5, -30},
    {-40, -20, 0, 5, 5, 0, -20, -40},
    {-50, -40, -30, -30, -30, -30, -40, -50}};

const centipawns_t WHITE_BISHOP_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {-20, -10, -10, -10, -10, -10, -10, -20},
    {-10, 0, 0, 0, 0, 0, 0, -10},
    {-10, 0, 5, 10, 10, 5, 0, -10},
    {-10, 5, 5, 10, 10, 5, 5, -10},
    {-10, 0, 10, 10, 10, 10, 0, -10},
    {-10, 10, 10, 10, 10, 10, 10, -10},
    {-10, 5, 0, 0, 0, 0, 5, -10},
    {-20, -10, -10, -10, -10, -10, -10, -20}};

const centipawns_t BLACK_BISHOP_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {-20, -10, -10, -10, -10, -10, -10, -20},
    {-10, 5, 0, 0, 0, 0, 5, -10},
    {-10, 10, 10, 10, 10, 10, 10, -10},
    {-10, 0, 10, 10, 10, 10, 0, -10},
    {-10, 5, 5, 10, 10, 5, 5, -10},
    {-10, 0, 5, 10, 10, 5, 0, -10},
    {-10, 0, 0, 0, 0, 0, 0, -10},
    {-20, -10, -10, -10, -10, -10, -10, -20}};

const centipawns_t WHITE_ROOK_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {0, 0, 0, 0, 0, 0, 0, 0},
    {5, 10, 10, 10, 10, 10, 10, 5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {0, 0, 0, 5, 5, 0, 0, 0}};

const centipawns_t BLACK_ROOK_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {0, 0, 0, 5, 5, 0, 0, 0},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {-5, 0, 0, 0, 0, 0, 0, -5},
    {5, 10, 10, 10, 10, 10, 10, 5},
    {0, 0, 0, 0, 0, 0, 0, 0}};

const centipawns_t QUEEN_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {-20, -10, -10, -5, -5, -10, -10, -20},
    {-10, 0, 0, 0, 0, 0, 0, -10},
    {-10, 0, 5, 5, 5, 5, 0, -10},
    {-5, 0, 5, 5, 5, 5, 0, -5},
    {0, 0, 5, 5, 5, 5, 0, -5},
    {-10, 5, 5, 5, 5, 5, 0, -10},
    {-10, 0, 5, 0, 0, 0, 0, -10},
    {-20, -10, -10, -5, -5, -10, -10, -20}};

const centipawns_t WHITE_KING_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-20, -30, -30, -40, -40, -30, -30, -20},
    {-10, -20, -20, -20, -20, -20, -20, -10},
    {20, 20, 0, 0, 0, 0, 20, 20},
    {20, 30, 10, 0, 0, 10, 30, 20}};

const centipawns_t BLACK_KING_VALUE_BONUSES[RANK_COUNT][FILE_COUNT] = {
    {20, 30, 10, 0, 0, 10, 30, 20},
    {20, 20, 0, 0, 0, 0, 20, 20},
    {-10, -20, -20, -20, -20, -20, -20, -10},
    {-20, -30, -30, -40, -40, -30, -30, -20},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30},
    {-30, -40, -40, -50, -50, -40, -40, -30}};

centipawns_t _eval_material(const board_t *board, side_t side);

centipawns_t eval(const board_t *board)
{
    centipawns_t score = 0;

    score += _eval_material(board, SIDE_WHITE);
    score -= _eval_material(board, SIDE_BLACK);

    if (board->side_to_move == SIDE_BLACK)
        score = -score;

    return score;
}

centipawns_t _eval_material(const board_t *board, side_t side)
{
    centipawns_t material_value = 0;

    for (int file = FILE_A; file <= FILE_H; file++)
        for (int rank = RANK_1; rank <= RANK_8; rank++)
        {
            square_t square = square_of(file, rank);
            piece_t piece = board_get(board, square);

            if (!(piece & side))
                continue;

            if ((piece & PIECE_PAWN))
                material_value += VALUE_PAWN + ((side & SIDE_WHITE) ? WHITE_PAWN_VALUE_BONUSES : BLACK_PAWN_VALUE_BONUSES)[rank][file];
            else if (piece & PIECE_KNIGHT)
                material_value += VALUE_KNIGHT + KNIGHT_VALUE_BONUSES[rank][file];
            else if (piece & PIECE_BISHOP)
                material_value += VALUE_BISHOP + ((side & SIDE_WHITE) ? WHITE_BISHOP_VALUE_BONUSES : BLACK_BISHOP_VALUE_BONUSES)[rank][file];
            else if (piece & PIECE_ROOK)
                material_value += VALUE_ROOK + ((side & SIDE_WHITE) ? WHITE_ROOK_VALUE_BONUSES : BLACK_ROOK_VALUE_BONUSES)[rank][file];
            else if (piece & PIECE_QUEEN)
                material_value += VALUE_QUEEN + QUEEN_VALUE_BONUSES[rank][file];
            else if (piece & PIECE_KING)
                material_value += VALUE_KING + ((side & SIDE_WHITE) ? WHITE_KING_VALUE_BONUSES : BLACK_KING_VALUE_BONUSES)[rank][file];
        }

    return material_value;
}